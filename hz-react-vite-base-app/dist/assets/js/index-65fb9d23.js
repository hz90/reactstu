import{o as R,r as o,a,M as U,j as c,B as p}from"./index-a3c4ad18.js";import{F as d,I as b}from"./index-53e73775.js";import{S as j,C as L}from"./index-cf0bcb26.js";import{C as q,U as B,a as P}from"./role-a782f789.js";import{u as m}from"./request-a5c2cf21.js";import{g as Y,a as E,b as V,e as $}from"./user-96a8b816.js";import{h as A,T as H,P as K}from"./moment-a321821f.js";import"./throttle-66c7b080.js";const _={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},G=R(s=>{const{isModalOpen:h,title:f,handleOk:i,handleCancel:g,loading:C,roleList:S,dataRef:n}=s,[u]=d.useForm();return o.useEffect(()=>{u.setFieldsValue({...n})},[n]),a(U,{forceRender:!0,title:f,footer:null,open:h,onCancel:g,children:c(d,{..._,form:u,name:"basic",labelCol:{span:5},initialValues:n,onFinish:r=>{n.id&&(r.id=n.id),i(r,f)},onFinishFailed:r=>{},size:"large",autoComplete:"off",children:[a(d.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入姓名"}],children:a(b,{placeholder:"请输入用户名"})}),a(d.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:a(b.Password,{autoComplete:"new-password",placeholder:"请输入密码"})}),a(d.Item,{label:"角色",name:"roleName",rules:[{required:!0,message:"请绑定角色"}],children:a(j,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"请绑定角色",defaultValue:n.roleName,options:S.map(r=>({label:r.roleName,value:r.roleName}))})}),c(d.Item,{children:[a(p,{onClick:()=>{u.resetFields(),g()},size:"middle",icon:a(q,{}),children:"取消"}),a(p,{loading:C,size:"middle",className:"save-btn",type:"primary",htmlType:"submit",icon:a(B,{}),children:"保存"})]})]})})});const{Search:J}=b,re=R(()=>{const[s,h]=o.useState({list:[],current:1,pageSize:10,total:0}),[f,i]=o.useState(!1),[g,C]=o.useState([]),[S,n]=o.useState(""),[u,y]=o.useState({username:"",password:"",roleName:[]}),I=[{title:"用户名称",dataIndex:"username",key:"username"},{title:"绑定角色",dataIndex:"signature",key:"signature"},{title:"创建时间",dataIndex:"ctime",key:"ctime"},{title:"操作",dataIndex:"id",render:(e,t)=>s.list.length>=1?c("div",{children:[a(p,{type:"primary",style:{marginRight:"10px"},onClick:()=>{w.run(),n("编辑用户"),y({id:t.id,username:t.username,password:t.password}),O.run({id:t.id}),i(!0)},children:"编辑"}),a(K,{title:`确定删除 ${t.username} 吗?`,cancelText:"取消",okText:"确定",onConfirm:()=>F(t.id),children:a(p,{danger:!0,type:"primary",children:"删除"})})]}):null}],{run:r,loading:k}=m(Y,{manual:!0,defaultParams:[{current:1,pageSize:10}],onSuccess:(e,t)=>{h({...e,list:e.list.map(l=>({...l,ctime:A(+l.ctime).format("YYYY-MM-DD HH:mm:ss")}))})}}),w=m(P,{manual:!0,onSuccess:(e,t)=>{C(e)}}),x=m(E,{manual:!0,onSuccess:(e,t)=>{}}),O=m(V,{manual:!0,onSuccess:(e,t)=>{y(l=>({...l,roleName:e}))}}),z=m($,{manual:!0,onSuccess:(e,t)=>{}}),F=e=>{const t=s.list.filter(l=>l.key!==e);h({...s.list,list:t})};o.useEffect(()=>{r({current:1,pageSize:10})},[]);const v=e=>console.log(e),N=()=>{},T=()=>{w.run(),n("新增用户"),y({username:"",password:"",roleName:[]}),i(!0)},D=async(e,t)=>{try{t==="新增用户"?await x.runAsync(e):await z.runAsync(e),i(!1),r({current:s.current,pageSize:s.pageSize})}catch{}},M=()=>{i(!1)};return c("div",{children:[c(L,{bordered:!1,children:[c("div",{className:"header",children:[a(J,{placeholder:"请输入用户名称关键词",loading:!1,onSearch:v,style:{width:200}}),a("div",{}),a(p,{type:"primary",loading:!1,onClick:T,children:"新增用户"})]}),a("div",{children:a(H,{columns:I,rowKey:e=>e.id,dataSource:s.list,pagination:{position:["bottomRight"],defaultCurrent:1,pageSize:s.pageSize,current:s.current,total:s.total,showTotal:e=>`共${e}条`,itemRender:(e,t,l)=>t==="prev"?a("a",{children:"上一页"}):t==="next"?a("a",{children:"下一页"}):l,onChange:(e,t)=>{r({current:e,pageSize:t})}},loading:k,onChange:N})})]}),a(G,{title:S,loading:x.loading,isModalOpen:f,roleList:g,dataRef:u,handleOk:D,handleCancel:M})]})});export{re as default};
